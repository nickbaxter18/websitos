{
  "version": 3,
  "sources": ["../../v2/config/flags.json", "../../v2/core/render.ts", "../../v2/core/modules/lead.ts", "../../v2/core/modules/ga4.ts", "../../v2/core/modules/utm_persist.ts", "../../v2/core/modules/consent_mode.ts", "../../v2/core/modules/seo_jsonld.ts", "../../v2/core/modules/sticky_mobile_cta.ts", "../../v2/core/modules/server_tagging.ts", "../../v2/core/modules/offers.ts", "../../v2/core/modules/rum_vitals.ts", "../../v2/core/modules/pwa_offline.ts", "../../v2/core/modules/checkout_price.ts", "../../v2/core/modules/checkout_sessions.ts", "../../v2/core/modules/index.ts", "../../v2/core/pipeline.ts"],
  "sourcesContent": ["\uFEFF{\n  \"lead_form_v2\": true, \"ga4_events\": true, \"utm_persist\": true,\n  \"consent_mode\": true, \"seo_jsonld\": true\n}\r\n", "\uFEFFimport fs from \"fs\"; import path from \"path\";\nexport type Ctx = { product?: any; persona?: any; tenant?: string; locale?: string; };\nconst root = path.resolve(process.cwd(), \"v2\");\nconst T = (f:string)=>fs.readFileSync(path.join(root,\"templates\",f),\"utf-8\");\nconst P = (f:string)=>fs.readFileSync(path.join(root,\"templates\",\"partials\",f),\"utf-8\");\nexport function readTemplates(ctx: Ctx){ let html=T(\"layout.html\");\n  html=html.replace(\"{{HEAD}}\",P(\"head.html\")).replace(\"{{HEADER}}\",P(\"header.html\")).replace(\"{{FOOTER}}\",P(\"footer.html\"));\n  html=html.replace(/{{GA4_ID}}/g, process.env.GA4_ID||\"G-BF3NB7NFEL\").replace(/{{SUPPORT_EMAIL}}/g, process.env.SUPPORT_EMAIL||\"nickbaxter@udigit.ca\");\n  return html;\n}\nexport function writeOut(html:string, ctx: Ctx){ const out=\"dist\"; fs.mkdirSync(out,{recursive:true});\n  const slug=(ctx.product?.slug||\"page\")+\".html\"; const p=path.join(out,slug); fs.writeFileSync(p,html); return { outPath:p, html };\n}\nexport function partial(name:string){ return P(name); }\r\n", "\uFEFFimport { partial } from \"../render.js\";\nexport default { flag:\"lead_form_v2\", async apply(html:string){ return html.replace(\"</main>\", `${partial(\"lead_form.html\")}</main>`); } };\r\n", "\uFEFFimport { partial } from \"../render.js\";\nexport default { flag:\"ga4_events\", async apply(html:string){ \n  return html.replace(\"</head>\", `${partial(\"ga4_head.html\")}</head>`); \n} };\r\n", "\uFEFFexport default { flag:\"utm_persist\", async apply(html:string){\n  return html.replace(\"</body>\", `<script src=\"/assets/analytics.js\" defer></script></body>`);\n} };\r\n", "\uFEFFimport { partial } from \"../render.js\";\nexport default { flag:\"consent_mode\", async apply(html:string){\n  var ga = (globalThis as any).process?.env?.GA4_ID || \"G-BF3NB7NFEL\";\n  var c = partial(\"consent.html\").replace(/%GA4_ID%/g, ga);\n  return html.replace(\"</body>\", c + \"</body>\");\n} };\r\n", "\uFEFFexport default { flag:\"seo_jsonld\", async apply(html:string, ctx:any){\n  const p=ctx?.product||{name:\"AI Funnel\",description:\"Launch faster with AI\",price:29,currency:\"USD\"};\n  const j={\"@context\":\"https://schema.org\",\"@type\":\"Product\",\"name\":p.name,\"description\":p.description,\"offers\":{\"@type\":\"Offer\",\"price\":String(p.price),\"priceCurrency\":p.currency}};\n  const s=`<script type=\"application/ld+json\">${JSON.stringify(j)}</script><meta property=\"og:title\" content=\"${p.name}\"><meta property=\"og:description\" content=\"${p.description}\">`;\n  return html.replace(\"</head>\", `${s}</head>`); } };\r\n", "\uFEFFimport { partial } from \"../render.js\";\nexport default { flag:\"sticky_mobile_cta\", async apply(html:string){\n  return html.replace(\"</body>\", `${partial(\"sticky_cta.html\")}</body>`);\n} };\r\n", "\uFEFFexport default { flag:\"server_tagging\", async apply(html:string){\n  const s=`<script>(function(){\n    window.udigitEmit=function(type,payload){\n      try{\n        const uid=localStorage.getItem(\"uid\")||\"\"; \n        const consent=localStorage.getItem(\"consent_choice_v2\")||\"unknown\";\n        const body=JSON.stringify({type,payload,uid,ts:Date.now(),consent});\n        navigator.sendBeacon && navigator.sendBeacon(\"/events\", new Blob([body],{type:\"application/json\"}));\n      }catch(e){}\n    };\n  })();</script>`;\n  return html.replace(\"</body>\", s+\"</body>\");\n} };\r\n", "\uFEFFexport function pickOrderBump(product:{price:number}){ return product && product.price<=29 ? \"ai_spark_starter\" : \"quick_win_addon\"; }\nexport default { flag:\"order_bump\", async apply(html:string, ctx:any){\n  const bump=pickOrderBump(ctx.product||{price:29});\n  const block=`<section class=\"order-bump\"><h3>Add ${bump.replace(/_/g,\" \")} for only $9</h3>\n  <label><input type=\"checkbox\" id=\"bump\"> Yes, add to my order</label></section>\n  <script>\n    (function(){\n      var el = document.getElementById(\"bump\");\n      if(!el) return;\n      el.addEventListener(\"change\", function(e){\n        var t = e && e.target ? e.target : {};\n        var checked = !!t.checked;\n        if (window.udigitEmit) window.udigitEmit(\"order_bump_toggle\", {checked: checked});\n      });\n    })();\n  </script>`;\n  return html.replace(\"</main>\", block+\"</main>\");\n} };\r\n", "\uFEFFexport default { flag:\"rum_vitals\", async apply(html:string){\n  const s=`<script src=\"https://unpkg.com/web-vitals@4/dist/web-vitals.umd.js\" defer onload=\"\n    webVitals.onLCP(v=>dispatchEvent(new CustomEvent('udigit:vital',{detail:{type:'LCP',value:v.value}})));\n    webVitals.onINP(v=>dispatchEvent(new CustomEvent('udigit:vital',{detail:{type:'INP',value:v.value}})));\n    webVitals.onCLS(v=>dispatchEvent(new CustomEvent('udigit:vital',{detail:{type:'CLS',value:v.value}})));\n  \"></script>`;\n  return html.replace(\"</body>\", s+\"</body>\");\n} };\r\n", "\uFEFFexport default { flag:\"pwa_offline\", async apply(html:string){\n  return html.replace(\"</body>\", `<script>if('serviceWorker' in navigator){navigator.serviceWorker.register('/sw.js').catch(()=>{});}</script></body>`);\n} };\r\n", "\uFEFFexport default { flag:\"checkout_price\", async apply(html:string){\n  const pid = (globalThis as any).process?.env?.STRIPE_PRICE_ID || \"price_TEST\";\n  return html.replace(\"</head>\", `<script>window.PRICE_ID='${pid}';</script></head>`);\n} };\r\n", "\uFEFFexport default { flag:\"checkout_sessions\", async apply(html:string){\n  const s=`<script>(function(){\n    function postCheckout(){\n      return fetch(\"/checkout\",{\n        method:\"POST\",\n        headers:{ \"content-type\":\"application/json\" },\n        body: JSON.stringify({\n          sku: window.PRODUCT_SLUG || \"offer\",\n          utm: JSON.parse(localStorage.getItem(\"utm\")||\"{}\"),\n          persona: window.PERSONA || \"default\"\n        })\n      })\n      .then(async r=>{\n        const ct=r.headers.get(\"content-type\")||\"\";\n        const body=ct.includes(\"application/json\")? await r.json() : {error: await r.text()};\n        if(!r.ok) throw body;\n        return body;\n      })\n      .then(j=>{ if(j && j.url){ location.href=j.url; } else { console.warn(\"Checkout unexpected:\", j); } })\n      .catch(e=>{ console.warn(\"Checkout error:\", e); alert((e && e.error) || \"Checkout failed\"); });\n    }\n\n    document.querySelectorAll(\"[data-cta=\\\\\"hero_buy\\\\\"],[data-cta=\\\\\"header_buy\\\\\"]\")\n      .forEach(function(btn){ btn.addEventListener(\"click\", function(e){ e.preventDefault(); postCheckout(); }); });\n  })();</script>`;\n  return html.replace(\"</body>\", s+\"</body>\");\n} };\r\n", "\uFEFFimport type { Ctx } from \"../render.js\";\ntype M = { flag:string; apply:(html:string, ctx:Ctx)=>Promise<string> };\n\nimport lead from \"./lead.js\";\nimport ga4 from \"./ga4.js\";\nimport utm from \"./utm_persist.js\";\nimport consent from \"./consent_mode.js\";\nimport seo from \"./seo_jsonld.js\";\nimport sticky from \"./sticky_mobile_cta.js\";\nimport tagging from \"./server_tagging.js\";\nimport offers from \"./offers.js\";\nimport rum from \"./rum_vitals.js\";\nimport pwa from \"./pwa_offline.js\";\nimport checkout_price from \"./checkout_price.js\";\nimport checkout_sessions from \"./checkout_sessions.js\";\n\nconst modules:M[] = [lead, ga4, utm, consent, seo, sticky, tagging, offers, rum, pwa, checkout_price, checkout_sessions];\nexport default modules;\r\n", "\uFEFFimport flags from \"../config/flags.json\" assert { type:\"json\" };\nimport { readTemplates, writeOut, type Ctx } from \"./render.js\"; import modules from \"./modules/index.js\";\nexport async function buildPage(ctx: Ctx){ let html=readTemplates(ctx);\n  for (const m of modules){ if ((flags as any)[m.flag]!==false) html=await m.apply(html, ctx); }\n  return writeOut(html, ctx);\n}\nexport default { buildPage };\r\n"],
  "mappings": "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",
  "names": []
}
